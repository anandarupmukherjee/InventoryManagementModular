<div class="heatmap-container">
  <h3 class="heatmap-title">Stock vs Threshold (Ratio)</h3>
  <div id="stockHeatmap" class="heatmap-grid"></div>
</div>

<script>
  const heatmapData = {{ stock_heatmap|safe }};
  const gridContainer = document.getElementById('stockHeatmap');

  function ratioToColor(ratio) {
    if (ratio <= 0.5) {
      return '#ef4444'; // red
    }
    if (ratio <= 0.8) {
      return '#f97316'; // orange
    }
    if (ratio <= 1.2) {
      return '#22c55e'; // green
    }
    return '#2563eb'; // blue for well above threshold
  }

  function renderHeatmap(data) {
    gridContainer.innerHTML = '';
    data.forEach(item => {
      const cell = document.createElement('div');
      cell.className = 'heatmap-cell';
      cell.style.backgroundColor = ratioToColor(item.ratio);
      cell.title = `${item.label} (Code: ${item.code})\nStock: ${item.stock}\nThreshold: ${item.threshold}\nRatio: ${item.ratio}`;
      gridContainer.appendChild(cell);
    });
  }

  renderHeatmap(heatmapData);
</script>
